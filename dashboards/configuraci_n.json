{
  "title": "Configuración",
  "configuration": {
    "widgets": {
      "fba8b82f-4b63-d360-68e1-9481f57706b1": {
        "isSystemType": true,
        "bundleAlias": "cards",
        "typeAlias": "entities_hierarchy",
        "type": "latest",
        "title": "New widget",
        "sizeX": 9,
        "sizeY": 11,
        "config": {
          "timewindow": {
            "realtime": {
              "interval": 1000,
              "timewindowMs": 86400000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "nodeRelationQueryFunction": "/**\n\n// Function should return relations query object for current node used to fetch entity children.\n// Function can return 'default' string value. In this case default relations query will be used.\n\n// The following example code will construct simple relations query that will fetch relations of type 'Contains'\n// from the current entity.\n\nvar entity = nodeCtx.entity;\nvar query = {\n    parameters: {\n        rootId: entity.id.id,\n        rootType: entity.id.entityType,\n        direction: types.entitySearchDirection.from,\n        relationTypeGroup: \"COMMON\",\n        maxLevel: 1\n    },\n    filters: [{\n        relationType: \"Contains\",\n        entityTypes: []\n    }]\n};\nreturn query;\n\n**/\n",
            "nodeHasChildrenFunction": "/**\n\n// Function should return boolean value indicating whether current node has children (whether it can be expanded).\n\n// The following example code will restrict entities hierarchy expansion up to third level.\n\nreturn nodeCtx.level <= 2;\n\n// The next example code will restrict entities expansion according to the value of example 'nodeHasChildren' attribute.\n\nvar data = nodeCtx.data;\nif (data.hasOwnProperty('nodeHasChildren') && data['nodeHasChildren'] !== null) {\n    return data['nodeHasChildren'] === 'true';\n} else {\n    return true;\n}\n  \n**/\n ",
            "nodeTextFunction": "/**\n\n// Function should return text (can be HTML code) for the current node.\n\n// The following example code will generate node text consisting of entity name and temperature if temperature value is present in entity attributes/timeseries.\n\nvar data =  nodeCtx.data;\nvar entity = nodeCtx.entity;\nvar text = entity.name;\nif (data.hasOwnProperty('temperature') && data['temperature'] !== null) {\n    text += \" <b>\"+ data['temperature'] +\" °C</b>\";\n}\nreturn text;\n\n**/\n\n//return \" <b>\"+nodeCtx.data['nombreEntidad']+\"</b>\";\nvar entity = nodeCtx.entity;\nvar nombreCompleto = entity.name;\nvar nombre = nombreCompleto.substring(nombreCompleto.indexOf(\"_\")+1);\nreturn nombre;",
            "nodeIconFunction": "/** \n\n// Function should return node icon info object.\n// Resulting object should contain either 'materialIcon' or 'iconUrl' property. \n// Where:\n    - 'materialIcon' - name of the material icon to be used from the Material Icons Library (https://material.io/tools/icons);\n    - 'iconUrl' - url of the external image to be used as node icon.\n// Function can return 'default' string value. In this case default icons according to entity type will be used.\n\n// The following example code shows how to use external image for devices which name starts with 'Test' and use \n// default icons for the rest of entities.\n\nvar entity = nodeCtx.entity;\nif (entity.id.entityType === 'DEVICE' && entity.name.startsWith('Test')) {\n    return {iconUrl: 'https://avatars1.githubusercontent.com/u/14793288?v=4&s=117'};\n} else {\n    return 'default';\n}\n \n**/",
            "nodeDisabledFunction": "/**\n\n// Function should return boolean value indicating whether current node should be disabled (not selectable).\n\n// The following example code will disable current node according to the value of example 'nodeDisabled' attribute.\n\nvar data = nodeCtx.data;\nif (data.hasOwnProperty('nodeDisabled') && data['nodeDisabled'] !== null) {\n    return data['nodeDisabled'] === 'true';\n} else {\n    return false;\n}\n  \n**/\n",
            "nodesSortFunction": "/**\n\n// This function is used to sort nodes of the same level. Function should compare two nodes and return \n// integer value: \n//     - less than 0 - sort nodeCtx1 to an index lower than nodeCtx2\n//     - 0 - leave nodeCtx1 and nodeCtx2 unchanged with respect to each other\n//     - greater than 0 - sort nodeCtx2 to an index lower than nodeCtx1\n\n// The following example code will sort entities first by entity type in alphabetical order then\n// by entity name in alphabetical order.\n\nvar result = nodeCtx1.entity.id.entityType.localeCompare(nodeCtx2.entity.id.entityType);\nif (result === 0) {\n    result = nodeCtx1.entity.name.localeCompare(nodeCtx2.entity.name);\n}\nreturn result;\n  \n**/",
            "nodeOpenedFunction": "/**\n\n// Function should return boolean value indicating whether current node should be opened (expanded) when it first loaded.\n\n// The following example code will open by default nodes up to third level.\n\nreturn nodeCtx.level <= 2;\n\n**/\n //return nodeCtx.level <=1;"
          },
          "title": "ACTIVOS Y DISPOSITIVOS",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "dataKeys": [],
              "entityAliasId": "bc41b835-4a1d-49fc-de3b-142ec2484fd4"
            }
          ],
          "widgetStyle": {},
          "actions": {
            "nodeSelected": [
              {
                "id": "a7202234-d4a6-48e7-81ed-4cbc6e19ecab",
                "name": "click",
                "icon": "more_horiz",
                "type": "customPretty",
                "customHtml": "<md-dialog aria-label=\"Edit entity\">\n    <md-tabs md-dynamic-height md-border-bottom>\n        <md-tab label=\"Editar\">\n            <form name=\"form.editEntityFormNull\"\n                ng-if=\"vm.entity.type=='ROOT'\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Editar activo ROOT\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">El activo\n                        ROOT es un requisito del\n                        sistema\n                        que no se puede editar.</div>\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-primary\">Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n            <form name=\"form.editEntityForm\"\n                class=\"edit-entity-form\"\n                ng-submit=\"vm.save()\"\n                ng-if=\"vm.entity.type!='ROOT'\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Editar\n                            {{vm.entityType.toLowerCase()==\"asset\"?\"activo\":\"dispositivo\"}}\n                            {{vm.attributes.nombreEntidad}}\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">\n                        <div layout=\"row\">\n                            <md-input-container flex\n                                class=\"md-block\">\n                                <label>Nombre</label>\n                                <input\n                                    ng-model=\"vm.attributes.nombreEntidad\"\n                                    required>\n                            </md-input-container>\n                            <md-input-container flex\n                                class=\"md-block\">\n                                <label>Tipo</label>\n                                <md-select\n                                    ng-model=\"vm.attributes.tipoEntidad\"\n                                    required>\n                                    <md-option\n                                        ng-if=\"vm.entityType.toLowerCase()=='device'\"\n                                        ng-repeat=\"tipo in vm.tiposDeDispositivos\"\n                                        ng-value=\"tipo\"\n                                        ng-selected=\"{{tipo == vm.attributes.tipoEntidad}}\">\n                                        {{tipo}}\n                                    </md-option>\n                                    <md-option\n                                        ng-if=\"vm.entityType.toLowerCase()=='asset'\"\n                                        ng-repeat=\"tipo in vm.tiposDeActivos\"\n                                        ng-value=\"tipo\"\n                                        ng-selected=\"{{tipo == vm.attributes.tipoEntidad}}\">\n                                        {{tipo}}\n                                    </md-option>\n                                </md-select>\n                            </md-input-container>\n                            <md-input-container flex\n                                class=\"md-block\">\n                                <label>Padre</label>\n                                <md-select\n                                    ng-model=\"vm.padre\"\n                                    required>\n                                    <md-option\n                                        ng-repeat=\"(name,valor) in vm.activos\"\n                                        ng-value=\"name\"\n                                        ng-selected=\"{{name == vm.padre}}\">\n                                        {{valor.atributos.nombreEntidad}}/{{valor.atributos.tipoEntidad}}\n                                    </md-option>\n                                </md-select>\n                            </md-input-container>\n                        </div>\n                    </div>\n\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button type=\"submit\"\n                        ng-disabled=\"form.editEntityForm.$invalid || !form.editEntityForm.$dirty\"\n                        class=\"md-raised md-primary\">Aceptar\n                    </md-button>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-primary\">Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n        </md-tab>\n\n        <md-tab label=\"crear\">\n            <form name=\"form.addEntityFormNull\"\n                ng-if=\"vm.entityType.toLowerCase()=='device'\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Crear entidad hija de\n                            {{vm.attributes.nombreEntidad}}\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">No se\n                        pueden crear entidades hijas de\n                        dispositivos.</div>\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-primary\">Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n            <form name=\"form.addEntityForm\"\n                class=\"add-entity-form\"\n                ng-submit=\"vm.crear()\"\n                ng-if=\"vm.entityType.toLowerCase()!='device'\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Crear entidad hija de\n                            {{vm.attributes.nombreEntidad}}\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">\n                        <div layout=\"row\">\n                            <md-input-container flex\n                                class=\"md-block\"\n                                style=\"min-width: 100px; width: 150px;\">\n                                <label>Nombre</label>\n                                <input\n                                    ng-model=\"vm.crearEntidad.nombreEntidad\"\n                                    name=nombreEntidad\n                                    required>\n                                <div\n                                    ng-messages=\"addEntityForm.nombreEntidad.$error\">\n                                    <div\n                                        ng-message=\"required\">\n                                        Es obligatorio\n                                        indicar un nombre.\n                                    </div>\n                                </div>\n                            </md-input-container>\n                            <tb-entity-type-select\n                                class=\"md-block\"\n                                style=\"min-width: 100px; width: 150px;\"\n                                the-form=\"addEntityForm\"\n                                tb-required=\"true\"\n                                allowed-entity-types=\"vm.allowedEntityTypes\"\n                                ng-model=\"vm.crearEntidad.tipoEntidad\">\n                            </tb-entity-type-select>\n\n                            <md-input-container flex\n                                class=\"md-block\"\n                                style=\"min-width: 100px; width: 150px;\">\n                                <label>Tipo de\n                                    {{vm.crearEntidad.tipoEntidad=='DEVICE'?'dispositivo':'activo'}}</label>\n                                <md-select\n                                    ng-model=\"vm.crearEntidad.subtipoEntidad\">\n                                    <md-option\n                                        ng-if=\"vm.crearEntidad.tipoEntidad.toLowerCase()=='device'\"\n                                        ng-repeat=\"tipo in vm.tiposDeDispositivos\"\n                                        ng-value=\"tipo\"\n                                        ng-selected=\"\">\n                                        {{tipo}}\n                                    </md-option>\n                                    <md-option\n                                        ng-if=\"vm.crearEntidad.tipoEntidad.toLowerCase()=='asset'\"\n                                        ng-repeat=\"tipo in vm.tiposDeActivos\"\n                                        ng-value=\"tipo\"\n                                        ng-selected=\"\">\n                                        {{tipo}}\n                                    </md-option>\n                                </md-select>\n                            </md-input-container>\n\n\n                        </div>\n                    </div>\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button type=\"submit\"\n                        ng-disabled=\"form.addEntityForm.$invalid || !form.addEntityForm.$dirty\"\n                        class=\"md-raised md-primary\">Crear\n                    </md-button>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-primary\">Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n        </md-tab>\n\n        <md-tab ng-if=\"vm.entityType.toLowerCase()=='device'\" label=\"configurar\">\n            <form name=\"form.configureEntityForm\"\n                class=\"configure-entity-form\"\n                ng-submit=\"vm.configurar()\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Configurar\n                            {{vm.attributes.nombreEntidad}}\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">\n                        <!-- CONFIGURACIÓN DEL NODO -->\n                        <sustituir class=\"ng-scope\"></sustituir>\n                        <!-- CONFIGURACIÓN DEL NODO -->\n                    </div>\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button type=\"submit\"\n                        ng-disabled=\"form.configureEntityForm.$invalid || !form.configureEntityForm.$dirty\"\n                        class=\"md-raised md-primary\">Configurar\n                    </md-button>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-primary\">Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n        </md-tab>\n\n        <md-tab label=\"borrar\">\n            <form name=\"form.deleteEntityFormNull\"\n                ng-if=\"vm.entity.type=='ROOT' || vm.borrable==false\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Borrar\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">No se\n                        puede borrar el activo ROOT ni los\n                        activos que tengan hijos.</div>\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-primary\">Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n            <form name=\"form.deleteEntityForm\"\n                class=\"delete-entity-form\"\n                ng-submit=\"vm.borrar()\"\n                ng-if=\"vm.entity.type!='ROOT' && vm.borrable==true\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>Borrar\n                            {{vm.attributes.nombreEntidad}}\n                        </h2>\n                        <span flex></span>\n                        <md-button class=\"md-icon-button\"\n                            ng-click=\"vm.cancel()\">\n                            <ng-md-icon icon=\"close\"\n                                aria-label=\"Close\">\n                            </ng-md-icon>\n                        </md-button>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content>\n                    <div class=\"md-dialog-content\">\n                        Esta operación no es reversible.\n                    </div>\n                </md-dialog-content>\n                <md-dialog-actions>\n                    <md-button type=\"submit\"\n                        class=\"md-primary\">Borrar\n                    </md-button>\n                    <md-button ng-click=\"vm.cancel()\"\n                        class=\"md-raised md-primary\">\n                        Cancelar\n                    </md-button>\n                </md-dialog-actions>\n            </form>\n        </md-tab>\n    </md-tabs>\n</md-dialog>\n\n<!--=======================================================================-->\n<!--=====  There are two example templates: for edit and add entity   =====-->\n<!--=======================================================================-->\n<!--========================  Edit entity example  ========================-->\n<!--=======================================================================-->\n<!-- -->\n<!--<md-dialog aria-label=\"Edit entity\">-->\n<!--    <form name=\"editEntityForm\" class=\"edit-entity-form\" ng-submit=\"vm.save()\">-->\n<!--        <md-toolbar>-->\n<!--            <div class=\"md-toolbar-tools\">-->\n<!--                <h2>Edit {{vm.entityType.toLowerCase()}} {{vm.entityName}}</h2>-->\n<!--                <span flex></span>-->\n<!--                <md-button class=\"md-icon-button\" ng-click=\"vm.cancel()\">-->\n<!--                    <ng-md-icon icon=\"close\" aria-label=\"Close\"></ng-md-icon>-->\n<!--                </md-button>-->\n<!--            </div>-->\n<!--        </md-toolbar>-->\n<!--        <md-dialog-content>-->\n<!--            <div class=\"md-dialog-content\">-->\n<!--                <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Entity Name</label>-->\n<!--                        <input ng-model=\"vm.entityName\" readonly>-->\n<!--                    </md-input-container>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Entity Type</label>-->\n<!--                        <input ng-model=\"vm.entityType\" readonly>-->\n<!--                    </md-input-container>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Type</label>-->\n<!--                        <input ng-model=\"vm.type\" readonly>-->\n<!--                    </md-input-container>-->\n<!--                </div>-->\n<!--                <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Latitude</label>-->\n<!--                        <input name=\"latitude\" type=\"number\" step=\"any\" ng-model=\"vm.attributes.latitude\">-->\n<!--                    </md-input-container>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Longitude</label>-->\n<!--                        <input name=\"longitude\" type=\"number\" step=\"any\" ng-model=\"vm.attributes.longitude\">-->\n<!--                    </md-input-container>-->\n<!--                </div>-->\n<!--                 <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Address</label>-->\n<!--                        <input ng-model=\"vm.attributes.address\">-->\n<!--                    </md-input-container>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Owner</label>-->\n<!--                        <input ng-model=\"vm.attributes.owner\">-->\n<!--                    </md-input-container>-->\n<!--                </div>-->\n<!--                <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Integer Value</label>-->\n<!--                        <input name=\"integerNumber\" type=\"number\" step=\"1\" ng-pattern=\"/^-?[0-9]+$/\" ng-model=\"vm.attributes.number\">-->\n<!--                        <div ng-messages=\"editEntityForm.integerNumber.$error\">-->\n<!--                            <div ng-message=\"pattern\">Invalid integer value.</div>-->\n<!--                        </div>-->\n<!--                    </md-input-container>-->\n<!--                    <div class=\"boolean-value-input\" layout=\"column\" layout-align=\"center start\" flex>-->\n<!--                        <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                        <md-checkbox ng-model=\"vm.attributes.booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                            {{ (vm.attributes.booleanValue ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                        </md-checkbox>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--                <div class=\"relations-list old-relations\">-->\n<!--                    <div class=\"md-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--                    <div class=\"body\" ng-show=\"vm.relations.length\">-->\n<!--                        <div class=\"row\" layout=\"row\" layout-align=\"start center\" ng-repeat=\"relation in vm.relations track by $index\">-->\n<!--                            <div class=\"md-whiteframe-1dp\" flex layout=\"row\" style=\"padding-left: 5px; margin-bottom: 3px;\">-->\n<!--                                <div flex layout=\"column\">-->\n<!--                                    <div layout=\"row\">-->\n<!--                                        <md-input-container class=\"md-block\" style=\"min-width: 100px;\">-->\n<!--                                            <label>Direction</label>-->\n<!--                                            <md-select ng-disabled=\"true\" required ng-model=\"relation.direction\">-->\n<!--                                                <md-option ng-repeat=\"direction in vm.entitySearchDirection\" ng-value=\"direction\">-->\n<!--                                                    {{ (\"relation.search-direction.\" + direction) | translate}}-->\n<!--                                                </md-option>-->\n<!--                                            </md-select>-->\n<!--                                        </md-input-container>-->\n<!--                                        <tb-relation-type-autocomplete ng-disabled=\"true\" flex class=\"md-block\"-->\n<!--                                           the-form=\"editEntityForm\"-->\n<!--                                           ng-model=\"relation.relationType\"-->\n<!--                                           tb-required=\"true\">-->\n<!--                                        </tb-relation-type-autocomplete>-->\n<!--                                    </div>-->\n<!--                                    <div layout=\"row\">-->\n<!--                                        <tb-entity-select flex class=\"md-block\"-->\n<!--                                            the-form=\"editEntityForm\"-->\n<!--                                            ng-disabled=\"true\"-->\n<!--                                            tb-required=\"true\"-->\n<!--                                            ng-model=\"relation.relatedEntity\">-->\n<!--                                        </tb-entity-select>-->\n<!--                                    </div>-->\n<!--                                </div>-->\n<!--                                <div layout=\"column\" layout-align=\"center center\">-->\n<!--                                    <md-button class=\"md-icon-button md-primary\" style=\"width: 40px; min-width: 40px;\"-->\n<!--                                               ng-click=\"vm.removeOldRelation($index,relation)\" aria-label=\"Remove\">-->\n<!--                                        <md-tooltip md-direction=\"top\">Remove relation</md-tooltip>-->\n<!--                                        <md-icon aria-label=\"Remove\" class=\"material-icons\">-->\n<!--                                            close-->\n<!--                                        </md-icon>-->\n<!--                                    </md-button>-->\n<!--                                </div>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--                <div class=\"relations-list\">-->\n<!--                    <div class=\"md-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">New Relations</div>-->\n<!--                    <div class=\"body\" ng-show=\"vm.newRelations.length\">-->\n<!--                        <div class=\"row\" layout=\"row\" layout-align=\"start center\" ng-repeat=\"relation in vm.newRelations track by $index\">-->\n<!--                            <div class=\"md-whiteframe-1dp\" flex layout=\"row\" style=\"padding-left: 5px; margin-bottom: 3px;\">-->\n<!--                                <div flex layout=\"column\">-->\n<!--                                    <div layout=\"row\">-->\n<!--                                        <md-input-container class=\"md-block\" style=\"min-width: 100px;\">-->\n<!--                                            <label>Direction</label>-->\n<!--                                            <md-select name=\"direction\" required ng-model=\"relation.direction\">-->\n<!--                                                <md-option ng-repeat=\"direction in vm.entitySearchDirection\" ng-value=\"direction\">-->\n<!--                                                    {{ (\"relation.search-direction.\" + direction) | translate}}-->\n<!--                                                </md-option>-->\n<!--                                            </md-select>-->\n<!--                                            <div ng-messages=\"editEntityForm.direction.$error\">-->\n<!--                                                <div ng-message=\"required\">Relation direction is required.</div>-->\n<!--                                            </div>-->\n<!--                                        </md-input-container>-->\n<!--                                        <tb-relation-type-autocomplete flex class=\"md-block\"-->\n<!--                                           the-form=\"editEntityForm\"-->\n<!--                                           ng-model=\"relation.relationType\"-->\n<!--                                           tb-required=\"true\">-->\n<!--                                        </tb-relation-type-autocomplete>-->\n<!--                                    </div>-->\n<!--                                    <div layout=\"row\">-->\n<!--                                        <tb-entity-select flex class=\"md-block\"-->\n<!--                                            the-form=\"editEntityForm\"-->\n<!--                                            tb-required=\"true\"-->\n<!--                                            ng-model=\"relation.relatedEntity\">-->\n<!--                                        </tb-entity-select>-->\n<!--                                    </div>-->\n<!--                                </div>-->\n<!--                                <div layout=\"column\" layout-align=\"center center\">-->\n<!--                                    <md-button class=\"md-icon-button md-primary\" style=\"width: 40px; min-width: 40px;\"-->\n<!--                                               ng-click=\"vm.removeRelation($index)\" aria-label=\"Remove\">-->\n<!--                                        <md-tooltip md-direction=\"top\">Remove relation</md-tooltip>-->\n<!--                                        <md-icon aria-label=\"Remove\" class=\"material-icons\">-->\n<!--                                            close-->\n<!--                                        </md-icon>-->\n<!--                                    </md-button>-->\n<!--                                </div>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                   <div>-->\n<!--                       <md-button class=\"md-primary md-raised\" ng-click=\"vm.addRelation()\" aria-label=\"Add\">-->\n<!--                           <md-tooltip md-direction=\"top\">Add Relation</md-tooltip>-->\n<!--                           Add-->\n<!--                       </md-button>-->\n<!--                   </div> -->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </md-dialog-content>-->\n<!--        <md-dialog-actions>-->\n<!--            <md-button type=\"submit\" ng-disabled=\"editEntityForm.$invalid || !editEntityForm.$dirty\" class=\"md-raised md-primary\">Save</md-button>-->\n<!--            <md-button ng-click=\"vm.cancel()\" class=\"md-primary\">Cancel</md-button>-->\n<!--        </md-dialog-actions>-->\n<!--    </form>-->\n<!--</md-dialog>-->\n<!---->\n<!--========================================================================-->\n<!--=========================  Add entity example  =========================-->\n<!--========================================================================-->\n<!---->\n<!--<md-dialog aria-label=\"Add entity\">-->\n<!--    <form name=\"addEntityForm\" class=\"add-entity-form\" ng-submit=\"vm.save()\">-->\n<!--        <md-toolbar>-->\n<!--            <div class=\"md-toolbar-tools\">-->\n<!--                <h2>Add entity</h2>-->\n<!--                <span flex></span>-->\n<!--                <md-button class=\"md-icon-button\" ng-click=\"vm.cancel()\">-->\n<!--                    <ng-md-icon icon=\"close\" aria-label=\"Close\"></ng-md-icon>-->\n<!--                </md-button>-->\n<!--            </div>-->\n<!--        </md-toolbar>-->\n<!--        <md-dialog-content>-->\n<!--            <div class=\"md-dialog-content\">-->\n<!--                <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Entity Name</label>-->\n<!--                        <input ng-model=\"vm.entityName\" name=entityName required>-->\n<!--                        <div ng-messages=\"addEntityForm.entityName.$error\">-->\n<!--                            <div ng-message=\"required\">Entity name is required.</div>-->\n<!--                        </div>-->\n<!--                    </md-input-container>-->\n<!--                    <tb-entity-type-select class=\"md-block\" style=\"min-width: 100px; width: 100px;\"-->\n<!--                       the-form=\"addEntityForm\"-->\n<!--                       tb-required=\"true\"-->\n<!--                       allowed-entity-types=\"vm.allowedEntityTypes\"-->\n<!--                       ng-model=\"vm.entityType\">-->\n<!--                    </tb-entity-type-select>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Entity Subtype</label>-->\n<!--                        <input ng-model=\"vm.type\" name=type required>-->\n<!--                        <div ng-messages=\"addEntityForm.type.$error\">-->\n<!--                            <div ng-message=\"required\">Entity subtype is required.</div>-->\n<!--                        </div>-->\n<!--                    </md-input-container>-->\n<!--                </div>-->\n<!--                <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Latitude</label>-->\n<!--                        <input name=\"latitude\" type=\"number\" step=\"any\" ng-model=\"vm.attributes.latitude\">-->\n<!--                    </md-input-container>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Longitude</label>-->\n<!--                        <input name=\"longitude\" type=\"number\" step=\"any\" ng-model=\"vm.attributes.longitude\">-->\n<!--                    </md-input-container>-->\n<!--                </div>-->\n<!--                 <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Address</label>-->\n<!--                        <input ng-model=\"vm.attributes.address\">-->\n<!--                    </md-input-container>-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Owner</label>-->\n<!--                        <input ng-model=\"vm.attributes.owner\">-->\n<!--                    </md-input-container>-->\n<!--                </div>-->\n<!--                <div layout=\"row\">-->\n<!--                    <md-input-container flex class=\"md-block\">-->\n<!--                        <label>Integer Value</label>-->\n<!--                        <input name=\"integerNumber\" type=\"number\" step=\"1\" ng-pattern=\"/^-?[0-9]+$/\" ng-model=\"vm.attributes.number\">-->\n<!--                        <div ng-messages=\"addEntityForm.integerNumber.$error\">-->\n<!--                            <div ng-message=\"pattern\">Invalid integer value.</div>-->\n<!--                        </div>-->\n<!--                    </md-input-container>-->\n<!--                    <div class=\"boolean-value-input\" layout=\"column\" layout-align=\"center start\" flex>-->\n<!--                        <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                        <md-checkbox ng-model=\"vm.attributes.booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                            {{ (vm.attributes.booleanValue ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                        </md-checkbox>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--                <div class=\"relations-list\">-->\n<!--                    <div class=\"md-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--                    <div class=\"body\" ng-show=\"vm.relations.length\">-->\n<!--                        <div class=\"row\" layout=\"row\" layout-align=\"start center\" ng-repeat=\"relation in vm.relations track by $index\">-->\n<!--                            <div class=\"md-whiteframe-1dp\" flex layout=\"row\" style=\"padding-left: 5px;\">-->\n<!--                                <div flex layout=\"column\">-->\n<!--                                    <div layout=\"row\">-->\n<!--                                        <md-input-container class=\"md-block\" style=\"min-width: 100px;\">-->\n<!--                                            <label>Direction</label>-->\n<!--                                            <md-select name=\"direction\" required ng-model=\"relation.direction\">-->\n<!--                                                <md-option ng-repeat=\"direction in vm.entitySearchDirection\" ng-value=\"direction\">-->\n<!--                                                    {{ (\"relation.search-direction.\" + direction) | translate}}-->\n<!--                                                </md-option>-->\n<!--                                            </md-select>-->\n<!--                                            <div ng-messages=\"addEntityForm.direction.$error\">-->\n<!--                                                <div ng-message=\"required\">Relation direction is required.</div>-->\n<!--                                            </div>-->\n<!--                                        </md-input-container>-->\n<!--                                        <tb-relation-type-autocomplete flex class=\"md-block\"-->\n<!--                                           the-form=\"addEntityForm\"-->\n<!--                                           ng-model=\"relation.relationType\"-->\n<!--                                           tb-required=\"true\">-->\n<!--                                        </tb-relation-type-autocomplete>-->\n<!--                                    </div>-->\n<!--                                    <div layout=\"row\">-->\n<!--                                        <tb-entity-select flex class=\"md-block\"-->\n<!--                                            the-form=\"addEntityForm\"-->\n<!--                                            tb-required=\"true\"-->\n<!--                                            ng-model=\"relation.relatedEntity\">-->\n<!--                                        </tb-entity-select>-->\n<!--                                    </div>-->\n<!--                                </div>-->\n<!--                                <div layout=\"column\" layout-align=\"center center\">-->\n<!--                                    <md-button class=\"md-icon-button md-primary\" style=\"width: 40px; min-width: 40px;\"-->\n<!--                                               ng-click=\"vm.removeRelation($index)\" aria-label=\"Remove\">-->\n<!--                                        <md-tooltip md-direction=\"top\">Remove relation</md-tooltip>-->\n<!--                                        <md-icon aria-label=\"Remove\" class=\"material-icons\">-->\n<!--                                            close-->\n<!--                                        </md-icon>-->\n<!--                                    </md-button>-->\n<!--                                </div>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                   <div>-->\n<!--                       <md-button class=\"md-primary md-raised\" ng-click=\"vm.addRelation()\" aria-label=\"Add\">-->\n<!--                           <md-tooltip md-direction=\"top\">Add Relation</md-tooltip>-->\n<!--                           Add-->\n<!--                       </md-button>-->\n<!--                   </div> -->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </md-dialog-content>-->\n<!--        <md-dialog-actions>-->\n<!--            <md-button type=\"submit\" ng-disabled=\"addEntityForm.$invalid || !addEntityForm.$dirty\" class=\"md-raised md-primary\">Create</md-button>-->\n<!--            <md-button ng-click=\"vm.cancel()\" class=\"md-primary\">Cancel</md-button>-->\n<!--        </md-dialog-actions>-->\n<!--    </form>-->\n<!--</md-dialog>-->",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form md-input-container {\n    padding-right: 10px;\n}\n\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body md-autocomplete-wrap md-input-container {\n    height: 30px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n\n.relations-list.old-relations tb-entity-select tb-entity-autocomplete button {\n    display: none;\n} \n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form md-input-container {\n    padding-right: 10px;\n}\n\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body md-autocomplete-wrap md-input-container {\n    height: 30px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar $mdDialog = $injector.get('$mdDialog'),\n    $document = $injector.get('$document'),\n    $location = $injector.get('$location'),\n    $q = $injector.get('$q'),\n    types = $injector.get('types'),\n    $rootScope = $injector.get('$rootScope'),\n    entityService = $injector.get('entityService'),\n    attributeService = $injector.get('attributeService'),\n    assetService = $injector.get('assetService'),\n    userService = $injector.get('userService'),\n    deviceService = $injector.get('deviceService'),\n    servicioHTTP = $injector.get(\n        '$http'),\n    entityRelationService = $injector.get(\n        'entityRelationService');\n\n//Obtengo el código de configuración del tipo de nodo\nvar notificaciones =\n    '<div flex layout=\"column\"> Notificaciones <div class=\"md-whiteframe-1dp\" flex layout=\"column\" style=\"padding-left: 5px; margin-bottom: 3px;\"> <div flex ng-show=\"vm.viasNotificacion.telegram\" layout=\"column\"> <label class=\"checkbox-label\">Telegram</label> <md-checkbox ng-disabled=\"!vm.attributes.alarmas.cambioDeEstado.enable || !vm.viasNotificacion.telegram\" ng-model=\"vm.attributes.alarmas.cambioDeEstado.telegram\" style=\"margin-bottom: 10px;\"> {{ (vm.attributes.alarmas.cambioDeEstado.telegram ? \"value.true\" : \"value.false\") | translate }} </md-checkbox> </div> <div flex ng-show=\"vm.viasNotificacion.email\" layout=\"column\"> <label class=\"checkbox-label\">email</label> <md-checkbox ng-disabled=\"!vm.attributes.alarmas.cambioDeEstado.enable || !vm.viasNotificacion.email\" ng-model=\"vm.attributes.alarmas.cambioDeEstado.email\" style=\"margin-bottom: 10px;\"> {{ (vm.attributes.alarmas.cambioDeEstado.email ? \"value.true\" : \"value.false\") | translate }} </md-checkbox> </div> <div flex ng-show=\"vm.viasNotificacion.ifttt\" layout=\"row\"> <div flex layout=\"column\"> <label class=\"checkbox-label\">IFTTT</label> <md-checkbox ng-disabled=\"!vm.attributes.alarmas.cambioDeEstado.enable || !vm.viasNotificacion.ifttt\" ng-model=\"vm.attributes.alarmas.cambioDeEstado.ifttt\" style=\"margin-bottom: 10px;\"> {{ (vm.attributes.alarmas.cambioDeEstado.ifttt ? \"value.true\" : \"value.false\") | translate }} </md-checkbox> </div> <md-input-container flex class=\"md-block\"> <label>Evento IFTTT</label> <input size=\"40\" ng-disabled=\"!vm.attributes.alarmas.cambioDeEstado.enable || !vm.attributes.alarmas.cambioDeEstado.ifttt\" ng-model=\"vm.attributes.alarmas.cambioDeEstado.iftttEvento\" ng-required=\"vm.attributes.alarmas.cambioDeEstado.enable && vm.attributes.alarmas.cambioDeEstado.ifttt\" > </md-input-container> </div> </div> </div><!--Final notificaciones-->';\nvar subtipo = \"\";\nvar htmlTemplate2 = htmlTemplate;\nif (entityId.entityType != types\n    .entityType.device) {\n    openEditEntityDialog();\n} else {\n    entityService.getEntity(entityId.entityType,\n        entityId.id).then(\n        function(entity) {\n            subtipo = entity.type;\n            attributeService.getEntityAttributesValues(\n                'CUSTOMER', userService\n                .getCurrentUser()\n                .customerId,\n                'SERVER_SCOPE').then(\n                function(data) {\n                    if (data.length) {\n                        getConfiguracion(\n                            data);\n                    }\n                });\n        });\n\n    getConfiguracion();\n}\n\n//openEditEntityDialog();\n\nfunction getConfiguracion(attributes) {\n    for (var i = 0; i < attributes.length; i++) {\n        if (attributes[i].key ==\n            subtipo + \"_config\") {\n                var copia=attributes[i].value;\n                var res = copia.split('<sustituir-notificaciones class=\"ng-scope\">');\n                console.log(res);\n                for(var j=1;j<res.length;j++){\n                    var res2=res[j].split('</sustituir-notificaciones>');\n                    res2=res2[0];\n                    console.log(res2);\n                    copia=copia.replace('<sustituir-notificaciones class=\"ng-scope\">'+res2+'</sustituir-notificaciones>',notificaciones.replace(/cambioDeEstado/g,res2));\n                }\n                htmlTemplate2=htmlTemplate2.replace('<sustituir class=\"ng-scope\"></sustituir>',copia);\n            \n        }\n\n    }\n    \n    openEditEntityDialog();\n}\n\n\nfunction openEditEntityDialog() {\n    $mdDialog.show({\n        controller: ['$scope', '$mdDialog',\n            EditEntityDialogController\n        ],\n        controllerAs: 'vm',\n        template: htmlTemplate2,\n        locals: {\n            entityId: entityId\n        },\n        parent: angular.element($document[0].body),\n        targetEvent: $event,\n        multiple: true,\n        clickOutsideToClose: false\n    });\n}\n\nfunction EditEntityDialogController($scope, $mdDialog) {\n    $scope.form = {};\n    var vm = this;\n    vm.entityId = entityId;\n    vm.entityName = entityName;\n    vm.entityType = entityId.entityType;\n    vm.allowedEntityTypes = [types.entityType.asset, types\n        .entityType.device\n    ];\n    vm.allowedRelatedEntityTypes = [];\n    vm.entitySearchDirection = types.entitySearchDirection;\n    vm.tiposDeDispositivos = {};\n    vm.tiposDeActivos = {};\n    vm.activos = {};\n    vm.padre = {};\n    vm.attributes = {};\n    vm.attributes.alarmas = {};\n    vm.viasNotificacion = {};\n\n    vm.serverAttributes = {};\n    vm.relations = [];\n    vm.newRelations = [];\n    vm.relationsToDelete = [];\n    vm.borrable = false;\n    vm.HTMLconfig = \"\";\n    vm.subtipo=subtipo;\n\n\n    getEntityInfo();\n\n    vm.addRelation = function() {\n        var relation = {\n            direction: null,\n            relationType: null,\n            relatedEntity: null\n        };\n        vm.newRelations.push(relation);\n        $scope.editEntityForm.$setDirty();\n    };\n    vm.removeRelation = function(index) {\n        if (index > -1) {\n            vm.newRelations.splice(index, 1);\n            $scope.editEntityForm.$setDirty();\n        }\n    };\n    vm.removeOldRelation = function(index, relation) {\n        if (index > -1) {\n            vm.relations.splice(index, 1);\n            vm.relationsToDelete.push(relation);\n            $scope.editEntityForm.$setDirty();\n        }\n    };\n    vm.borrar = function() {\n        openDeleteEntityDialog();\n\n        function openDeleteEntityDialog() {\n            $scope.form.deleteEntityForm\n                .$setPristine();\n            var title = 'Borrar ' +\n                entityName;\n            var content =\n                '¿Seguro que desea borrar la entidad ' +\n                entityName + '?';\n            var confirm = $mdDialog.confirm()\n                .targetEvent($event)\n                .title(title)\n                .htmlContent(content)\n                .ariaLabel(title)\n                .cancel('Cancelar')\n                .ok('Borrar');\n            $mdDialog.show(confirm).then(function() {\n                deleteEntity();\n            });\n        }\n\n        function deleteEntity() {\n            servicioHTTP({\n                method: 'POST',\n                url: $location.protocol() +\n                    '://' +\n                    $location.host() +\n                    '/api/v1/' + vm\n                    .tokenControl +\n                    '/telemetry',\n                data: \"{'accion':'borrarEntidad','nombreEntidad':'\" +\n                    vm\n                    .attributes.nombreEntidad +\n                    \"','idEntidad':'\" +\n                    vm.entityId.id +\n                    \"','tipoEntidad':'\" + vm\n                    .entityType +\n                    \"'}\"\n            }).\n            success(function(data, status, headers,\n                config) {\n\n                console.log('worked');\n                updateAliasData();\n                $mdDialog.hide();\n                // ...\n            }).\n            error(function(data, status, headers,\n                config) {\n                console.log('notworked');\n                // ...\n            });\n        }\n    };\n    vm.crear = function() {\n        //TODO: Gestionar colisión de nombres\n        servicioHTTP({\n            method: 'POST',\n            url: $location.protocol() + '://' +\n                $location.host() +\n                '/api/v1/' + vm.tokenControl +\n                '/telemetry',\n            data: \"{'accion':'crearEntidad','nombreEntidad':'\" +\n                vm.crearEntidad.nombreEntidad +\n                \"','tipoEntidad':'\" + vm\n                .crearEntidad.tipoEntidad +\n                \"','subtipoEntidad':'\" + vm\n                .crearEntidad.subtipoEntidad +\n                \"','padreEntidadId':'\" + vm\n                .entityId.id +\n                \"','padreEntidadNombre':'\" + vm\n                .entityName + \"'}\"\n        }).\n        success(function(data, status, headers,\n            config) {\n            console.log('worked');\n            updateAliasData();\n            $scope.form.addEntityForm\n                .$setPristine();\n            $mdDialog.hide();\n            // ...\n        }).\n        error(function(data, status, headers,\n            config) {\n            console.log('notworked');\n            // ...\n        });\n    };\n\n    vm.save = function() {\n        \n\n        //console.log(vm.attributes);\n        servicioHTTP({\n            method: 'POST',\n            url: $location.protocol() + '://' +\n                $location.host() +\n                '/api/v1/' + vm.tokenControl +\n                '/telemetry',\n            data: \"{'accion':'editarEntidad','idEntidad':'\" +\n                vm.entityId.id +\n                \"','nombreEntidad':'\" + vm\n                .attributes.nombreEntidad +\n                \"','subtipoEntidad':'\" + vm\n                .attributes.tipoEntidad +\n                \"','tipoEntidad':'\" + vm\n                .entityType +\n                \"','padreEntidad':'\" + vm\n                .padre +\n                \"','tipoPadreEntidad':'\" + vm\n                .activos[vm.padre].tipo + \"'}\"\n        }).\n        success(function(data, status, headers,\n            config) {\n            console.log('worked');\n            updateAliasData();\n            $scope.form.editEntityForm\n                .$setPristine();\n            $mdDialog.hide();\n            // ...\n        }).\n        error(function(data, status, headers,\n            config) {\n            console.log('notworked');\n            // ...\n        });\n\n\n        //saveAttributes();\n        //saveRelations();\n        //$scope.editEntityForm.$setPristine();\n    };\n    \n    vm.configurar = function() {\n        //Si hay atributos de alarma tengo que stringficarlos\n\n        vm.attributes.alarmas= JSON.stringify(vm\n            .attributes.alarmas);\n\n        //console.log(vm.attributes);\n        servicioHTTP({\n            method: 'POST',\n            url: $location.protocol() + '://' +\n                $location.host() +\n                '/api/v1/' + vm.tokenControl +\n                '/telemetry',\n            data: \"{'accion':'configurarEntidad','idEntidad':'\" +\n                vm.entityId.id +\n                \"','alarmas':'\" + vm\n                .attributes.alarmas + \"'}\"\n        }).\n        success(function(data, status, headers,\n            config) {\n            console.log('worked');\n            updateAliasData();\n            $scope.form.editEntityForm\n                .$setPristine();\n            $mdDialog.hide();\n            // ...\n        }).\n        error(function(data, status, headers,\n            config) {\n            console.log('notworked');\n            // ...\n        });\n\n\n        //saveAttributes();\n        //saveRelations();\n        //$scope.editEntityForm.$setPristine();\n    };\n    \n    vm.cancel = function() {\n        $mdDialog.hide();\n    };\n\n    function getEntityAttributes(attributes) {\n        for (var i = 0; i < attributes.length; i++) {\n            if (attributes[i].key==\"alarma_\"+vm.subtipo) {\n               \n                var alarmas=JSON.parse(attributes[i].value);\n                 \n                for (var key in alarmas) {\n                    vm.attributes.alarmas[key\n                        ] = \n                        alarmas[key];\n                }\n            } else {\n                vm.attributes[attributes[i].key] =\n                    attributes[i].value;\n            }\n        }\n        vm.serverAttributes = angular.copy(vm.attributes);\n    }\n\n    function getTiposDeActivosYDispositivos(attributes) {\n        for (var i = 0; i < attributes.length; i++) {\n            if (attributes[i].key ==\n                \"tiposDeDispositivos\") {\n                vm.tiposDeDispositivos = attributes[i].value\n                    .split(\",\");\n            } else if (attributes[i].key ==\n                \"tiposDeActivos\") {\n                vm.tiposDeActivos = attributes[i].value\n                    .split(\",\");\n            } else if (attributes[i].key ==\n                \"email\") {\n                if (attributes[i].value !== \"\") {\n                    vm.viasNotificacion.email = true;\n                } else {\n                    vm.viasNotificacion.email = false;\n                }\n            } else if (attributes[i].key ==\n                \"token_telegram\") {\n                if (attributes[i].value !== \"\") {\n                    vm.viasNotificacion.telegram = true;\n                } else {\n                    vm.viasNotificacion.telegram = false;\n                }\n\n            } else if (attributes[i].key ==\n                \"token_webhook_ifttt\") {\n                if (attributes[i].value !== \"\") {\n                    vm.viasNotificacion.ifttt = true;\n                } else {\n                    vm.viasNotificacion.ifttt = false;\n                }\n            }\n        }\n\n    }\n\n\n    function getActivos(activos) {\n        //Los uso para establecer los padres\n        //Aquí habrá que generalizar para usar los atributos nombre y tipo, en lugar de los fields\n        for (var i = 0; i < activos.length; i++) {\n            //Si es un activo no debe incluirse a sí mismo\n            if (vm.entityType == \"DEVICE\" || vm.entityId\n                .id !=\n                activos[i].id.id) {\n                getAtributosActivo(activos[i].id.id,\n                    activos[i].name, activos[i].type);\n\n            } else {\n                //console.log(\"b_\" + vm.entityId.id + \"__\" +activos[i].id.id);\n            }\n        }\n        //console.log(vm.activos);\n    }\n\n    function getAtributosActivo(id, nombreActivo,\n        tipoActivo) {\n        attributeService.getEntityAttributesValues('ASSET',\n            id, 'SERVER_SCOPE').then(\n            function success(data) {\n                var parametros = {};\n                for (var i = 0; i < data.length; i++) {\n                    //console.log(data[i].key,data[i].value);\n                    parametros[data[i].key] = data[i]\n                        .value;\n                }\n                vm.activos[nombreActivo] = {\n                    'tipo': tipoActivo,\n                    'atributos': parametros\n                };\n                //console.log(vm.activos[nombreActivo]);\n\n            });\n    }\n\n\n    function getEntityRelations(relations) {\n        var relationsFrom = relations[0];\n        var relationsTo = relations[1];\n        //Si tiene hijos no se puede borrar\n        vm.borrable = true;\n        for (var i = 0; i < relationsFrom.length; i++) {\n            vm.borrable = false;\n            var relation = {\n                direction: types\n                    .entitySearchDirection.from,\n                relationType: relationsFrom[i].type,\n                relatedEntity: relationsFrom[i].to\n            };\n            vm.relations.push(relation);\n        }\n\n        for (var i = 0; i < relationsTo.length; i++) {\n\n            var relation = {\n                direction: types\n                    .entitySearchDirection.to,\n                relationType: relationsTo[i].type,\n                relatedEntity: relationsTo[i].from\n            };\n            if (relation.relationType == \"Contains\" &&\n                relation.relatedEntity.entityType == \"ASSET\"\n            ) {\n                establecerNombrePadre(relation.relatedEntity\n                    .id);\n                //Necesito el nombre del padre\n            }\n            vm.relations.push(relation);\n        }\n\n    }\n\n    function establecerNombrePadre(id) {\n        assetService.getAsset(id).then(\n            function(data) {\n                vm.padre = data.name;\n                //console.log(vm.padre);\n            }\n        );\n    }\n\n    function getEntityInfo() {\n        entityService.getEntity(entityId.entityType,\n            entityId.id).then(\n            function(entity) {\n                vm.entity = entity;\n                vm.type = vm.entity.type;\n            });\n\n        attributeService.getEntityAttributesValues(\n            entityId.entityType, entityId.id,\n            'SERVER_SCOPE').then(\n            function(data) {\n                if (data.length) {\n                    getEntityAttributes(data);\n                }\n            });\n        //Obtngo los tipos de activos y dispositivos \n        //que tiene permitidos el customer en sus atributos\n        //y también las vías de notificación (ifttt, telegram...)\n        attributeService.getEntityAttributesValues(\n            'CUSTOMER', userService.getCurrentUser()\n            .customerId,\n            'SERVER_SCOPE').then(\n            function(data) {\n                if (data.length) {\n                    getTiposDeActivosYDispositivos(\n                        data);\n                }\n            });\n        //Obtengo los activos del customer para poder\n        //mostrarlos como potenciales padres\n        assetService.getCustomerAssets(userService\n            .getCurrentUser()\n            .customerId, {\n                \"limit\": 100\n            }).then(\n            function(data) {\n                if (data.data.length) {\n                    getActivos(data.data);\n\n                }\n            });\n\n        //Obtengo el token del dispositivo SYSTEM\n        deviceService.getCustomerDevices(userService\n            .getCurrentUser().customerId, {\n                \"limit\": 100\n            }, false, {}, 'SYSTEM').then(\n            function(data) {\n                if (data.data.length == 1) {\n                    deviceService.getDeviceCredentials(\n                        data.data[0].id.id, true, {}\n                    ).then(\n                        function(response) {\n                            vm.tokenControl =\n                                response\n                                .credentialsId;\n\n                        });\n                }\n            });\n\n\n        $q.all([entityRelationService.findInfoByFrom(\n                entityId.id, entityId.entityType\n            ), entityRelationService\n            .findInfoByTo(entityId.id, entityId\n                .entityType)\n        ]).then(\n            function(relations) {\n                getEntityRelations(relations);\n            });\n\n    }\n\n    function saveAttributes() {\n        var attributesArray = [];\n        for (var key in vm.attributes) {\n            if (vm.attributes[key] !== vm\n                .serverAttributes[key]) {\n                attributesArray.push({\n                    key: key,\n                    value: vm.attributes[key]\n                });\n            }\n        }\n        if (attributesArray.length > 0) {\n            attributeService.saveEntityAttributes(\n                entityId.entityType, entityId.id,\n                \"SERVER_SCOPE\", attributesArray);\n        }\n    }\n\n    function saveRelations() {\n        var tasks = [];\n        for (var i = 0; i < vm.newRelations\n            .length; i++) {\n            var relation = {\n                type: vm.newRelations[i]\n                    .relationType\n            };\n            if (vm.newRelations[i].direction == types\n                .entitySearchDirection.from) {\n                relation.to = vm.newRelations[i]\n                    .relatedEntity;\n                relation.from = entityId;\n            } else {\n                relation.to = entityId;\n                relation.from = vm.newRelations[i]\n                    .relatedEntity;\n            }\n            tasks.push(entityRelationService\n                .saveRelation(relation));\n        }\n        for (var i = 0; i < vm.relationsToDelete\n            .length; i++) {\n            var relation = {\n                type: vm.relationsToDelete[i]\n                    .relationType\n            };\n            if (vm.relationsToDelete[i].direction ==\n                types.entitySearchDirection.from) {\n                relation.to = vm.relationsToDelete[i]\n                    .relatedEntity;\n                relation.from = entityId;\n            } else {\n                relation.to = entityId;\n                relation.from = vm.relationsToDelete[i]\n                    .relatedEntity;\n            }\n            tasks.push(entityRelationService\n                .deleteRelation(relation.from.id,\n                    relation.from.entityType,\n                    relation.type, relation.to.id,\n                    relation.to.entityType));\n        }\n        $q.all(tasks).then(function() {\n            vm.relations = vm.relations.concat(\n                vm.newRelations);\n            vm.newRelations = [];\n            vm.relationsToDelete = [];\n            updateAliasData();\n        });\n    }\n\n    function updateAliasData() {\n        var aliasIds = [];\n        for (var id in widgetContext.aliasController\n                .resolvedAliases) {\n            aliasIds.push(id);\n        }\n        var tasks = [];\n        aliasIds.forEach(function(aliasId) {\n            widgetContext.aliasController\n                .setAliasUnresolved(aliasId);\n            tasks.push(widgetContext\n                .aliasController\n                .getAliasInfo(aliasId));\n        });\n        $q.all(tasks).then(function() {\n            $rootScope.$broadcast(\n                'entityAliasesChanged',\n                aliasIds);\n        });\n    }\n}\n\n/*=======================================================================*/\n/*=====  There are three examples: for delete, edit and add entity  =====*/\n/*=======================================================================*/\n/*=======================  Delete entity example  =======================*/\n/*=======================================================================*/\n//\n//var $injector = widgetContext.$scope.$injector;\n//var $mdDialog = $injector.get('$mdDialog'),\n//    $document = $injector.get('$document'),\n//    types = $injector.get('types'),\n//    assetService = $injector.get('assetService'),\n//    deviceService = $injector.get('deviceService')\n//    $rootScope = $injector.get('$rootScope'),\n//    $q = $injector.get('$q');\n//\n//openDeleteEntityDialog();\n//\n//function openDeleteEntityDialog() {\n//    var title = 'Delete ' + entityId.entityType\n//        .toLowerCase() + ' ' +\n//        entityName;\n//    var content = 'Are you sure you want to delete the ' +\n//        entityId.entityType.toLowerCase() + ' ' +\n//        entityName + '?';\n//    var confirm = $mdDialog.confirm()\n//        .targetEvent($event)\n//        .title(title)\n//        .htmlContent(content)\n//        .ariaLabel(title)\n//        .cancel('Cancel')\n//        .ok('Delete');\n//    $mdDialog.show(confirm).then(function() {\n//        deleteEntity();\n//    })\n//}\n//\n//function deleteEntity() {\n//    deleteEntityPromise(entityId).then(\n//        function success() {\n//            updateAliasData();\n//        },\n//        function fail() {\n//            showErrorDialog();\n//        }\n//    );\n//}\n//\n//function deleteEntityPromise(entityId) {\n//    if (entityId.entityType == types.entityType.asset) {\n//        return assetService.deleteAsset(entityId.id);\n//    } else if (entityId.entityType == types.entityType.device) {\n//        return deviceService.deleteDevice(entityId.id);\n//    }\n//}\n//\n//function updateAliasData() {\n//    var aliasIds = [];\n//    for (var id in widgetContext.aliasController.resolvedAliases) {\n//        aliasIds.push(id);\n//    }\n//    var tasks = [];\n//    aliasIds.forEach(function(aliasId) {\n//        widgetContext.aliasController.setAliasUnresolved(aliasId);\n//        tasks.push(widgetContext.aliasController.getAliasInfo(aliasId));\n//    });\n//    $q.all(tasks).then(function() {\n//        $rootScope.$broadcast('entityAliasesChanged', aliasIds);\n//    });\n//}\n//\n//function showErrorDialog() {\n//    var title = 'Error';\n//    var content = 'An error occurred while deleting the entity. Please try again.';\n//    var alert = $mdDialog.alert()\n//        .title(title)\n//        .htmlContent(content)\n//        .ariaLabel(title)\n//        .parent(angular.element($document[0].body))\n//        .targetEvent($event)\n//        .multiple(true)\n//        .clickOutsideToClose(true)\n//        .ok('CLOSE');\n//    $mdDialog.show(alert);\n//}\n//\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n//\n//var $injector = widgetContext.$scope.$injector;\n//var $mdDialog = $injector.get('$mdDialog'),\n//    $document = $injector.get('$document'),\n//    $q = $injector.get('$q'),\n//    types = $injector.get('types'),\n//    $rootScope = $injector.get('$rootScope'),\n//    entityService = $injector.get('entityService'),\n//    attributeService = $injector.get('attributeService'),\n//    entityRelationService = $injector.get('entityRelationService');\n//\n//openEditEntityDialog();\n//\n//function openEditEntityDialog() {\n//    $mdDialog.show({\n//        controller: ['$scope','$mdDialog', EditEntityDialogController],\n//        controllerAs: 'vm',\n//        template: htmlTemplate,\n//        locals: {\n//            entityId: entityId\n//        },\n//        parent: angular.element($document[0].body),\n//        targetEvent: $event,\n//        multiple: true,\n//        clickOutsideToClose: false\n//    });\n//}\n//\n//function EditEntityDialogController($scope,$mdDialog) {\n//    var vm = this;\n//    vm.entityId = entityId;\n//    vm.entityName = entityName;\n//    vm.entityType = entityId.entityType;\n//    vm.allowedEntityTypes = [types.entityType.asset, types.entityType.device];\n//    vm.allowedRelatedEntityTypes = [];\n//    vm.entitySearchDirection = types.entitySearchDirection;\n//    vm.attributes = {};\n//    vm.serverAttributes = {};\n//    vm.relations = [];\n//    vm.newRelations = [];\n//    vm.relationsToDelete = [];\n//    getEntityInfo();\n//    \n//    vm.addRelation = function() {\n//        var relation = {\n//            direction: null,\n//            relationType: null,\n//            relatedEntity: null\n//        };\n//        vm.newRelations.push(relation);\n//        $scope.editEntityForm.$setDirty();\n//    };\n//    vm.removeRelation = function(index) {\n//        if (index > -1) {\n//            vm.newRelations.splice(index, 1);\n//            $scope.editEntityForm.$setDirty();\n//        }\n//    };\n//    vm.removeOldRelation = function(index, relation) {\n//        if (index > -1) {\n//            vm.relations.splice(index, 1);\n//            vm.relationsToDelete.push(relation);\n//            $scope.editEntityForm.$setDirty();\n//        }\n//    };\n//    vm.save = function() {\n//        saveAttributes();\n//        saveRelations();\n//        $scope.editEntityForm.$setPristine();\n//    };\n//    vm.cancel = function() {\n//        $mdDialog.hide();\n//    };\n//    \n//    function getEntityAttributes(attributes) {\n//        for (var i = 0; i < attributes.length; i++) {\n//              vm.attributes[attributes[i].key] = attributes[i].value; \n//        }\n//        vm.serverAttributes = angular.copy(vm.attributes);\n//    }\n//    \n//    function getEntityRelations(relations) {\n//        var relationsFrom = relations[0];\n//        var relationsTo = relations[1];\n//        for (var i=0; i < relationsFrom.length; i++) {\n//            var relation = {\n//                direction: types.entitySearchDirection.from,\n//                relationType: relationsFrom[i].type,\n//                relatedEntity: relationsFrom[i].to\n//            };\n//            vm.relations.push(relation);\n//        }\n//        for (var i=0; i < relationsTo.length; i++) {\n//            var relation = {\n//                direction: types.entitySearchDirection.to,\n//                relationType: relationsTo[i].type,\n//                relatedEntity: relationsTo[i].from\n//            };\n//            vm.relations.push(relation);\n//        }\n//    }\n//    \n//    function getEntityInfo() {\n//        entityService.getEntity(entityId.entityType, entityId.id).then(\n//            function(entity) {\n//                vm.entity = entity;\n//                vm.type = vm.entity.type;\n//            });\n//        attributeService.getEntityAttributesValues(entityId.entityType, entityId.id, 'SERVER_SCOPE').then(\n//            function(data){\n//                if (data.length) {\n//                    getEntityAttributes(data);\n//                }\n//            });\n//        $q.all([entityRelationService.findInfoByFrom(entityId.id, entityId.entityType), entityRelationService.findInfoByTo(entityId.id, entityId.entityType)]).then(\n//            function(relations){\n//                getEntityRelations(relations);\n//            });\n//    }\n//    \n//    function saveAttributes() {\n//        var attributesArray = [];\n//        for (var key in vm.attributes) {\n//            if (vm.attributes[key] !== vm.serverAttributes[key]) {\n//                attributesArray.push({key: key, value: vm.attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            attributeService.saveEntityAttributes(entityId.entityType, entityId.id, \"SERVER_SCOPE\", attributesArray);\n//        } \n//    }\n//    \n//    function saveRelations() {\n//        var tasks = [];\n//        for (var i=0; i < vm.newRelations.length; i++) {\n//            var relation = {\n//                type: vm.newRelations[i].relationType\n//            };\n//            if (vm.newRelations[i].direction == types.entitySearchDirection.from) {\n//                relation.to = vm.newRelations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = vm.newRelations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        for (var i=0; i < vm.relationsToDelete.length; i++) {\n//            var relation = {\n//                type: vm.relationsToDelete[i].relationType\n//            };\n//            if (vm.relationsToDelete[i].direction == types.entitySearchDirection.from) {\n//                relation.to = vm.relationsToDelete[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = vm.relationsToDelete[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.deleteRelation(relation.from.id, relation.from.entityType, relation.type, relation.to.id, relation.to.entityType));\n//        }\n//        $q.all(tasks).then(function(){\n//            vm.relations = vm.relations.concat(vm.newRelations);\n//            vm.newRelations = [];\n//            vm.relationsToDelete = [];\n//            updateAliasData();\n//        });\n//    }\n//    \n//    function updateAliasData() {\n//        var aliasIds = [];\n//        for (var id in widgetContext.aliasController.resolvedAliases) {\n//            aliasIds.push(id);\n//        }\n//        var tasks = [];\n//        aliasIds.forEach(function(aliasId) {\n//            widgetContext.aliasController.setAliasUnresolved(aliasId);\n//            tasks.push(widgetContext.aliasController.getAliasInfo(aliasId));\n//        });\n//        $q.all(tasks).then(function() {\n//            $rootScope.$broadcast('entityAliasesChanged', aliasIds);\n//        });\n//    }\n//}\n//\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n//\n//var $injector = widgetContext.$scope.$injector;\n//var $mdDialog = $injector.get('$mdDialog'),\n//    $document = $injector.get('$document'),\n//    $q = $injector.get('$q'),\n//    $rootScope = $injector.get('$rootScope'),\n//    types = $injector.get('types'),\n//    assetService = $injector.get('assetService'),\n//    deviceService = $injector.get('deviceService'),\n//    attributeService = $injector.get('attributeService'),\n//    entityRelationService = $injector.get('entityRelationService');\n//\n//openAddEntityDialog();\n//\n//function openAddEntityDialog() {\n//    $mdDialog.show({\n//        controller: ['$scope','$mdDialog', AddEntityDialogController],\n//        controllerAs: 'vm',\n//        template: htmlTemplate,\n//        locals: {\n//            entityId: entityId\n//        },\n//        parent: angular.element($document[0].body),\n//        targetEvent: $event,\n//        multiple: true,\n//        clickOutsideToClose: false\n//    });\n//}\n//\n//function AddEntityDialogController($scope, $mdDialog) {\n//    var vm = this;\n//    vm.allowedEntityTypes = [types.entityType.asset, types.entityType.device];\n//    vm.allowedRelatedEntityTypes = [];\n//    vm.entitySearchDirection = types.entitySearchDirection;\n//    vm.attributes = {};\n//    vm.relations = [];\n//    \n//    vm.addRelation = function() {\n//        var relation = {\n//            direction: null,\n//            relationType: null,\n//            relatedEntity: null\n//        };\n//        vm.relations.push(relation);\n//    };\n//    vm.removeRelation = function(index) {\n//        if (index > -1) {\n//            vm.relations.splice(index, 1);\n//        }\n//    };\n//    vm.save = function() {\n//        $scope.addEntityForm.$setPristine();\n//        saveEntityPromise().then(\n//            function (entity) {\n//                saveAttributes(entity.id);\n//                saveRelations(entity.id);\n//                $mdDialog.hide();\n//            }\n//        );\n//    };\n//    vm.cancel = function() {\n//        $mdDialog.hide();\n//    };\n//    \n//    \n//    function saveEntityPromise() {\n//        var entity = {\n//            name: vm.entityName,\n//            type: vm.type\n//        };\n//        if (vm.entityType == types.entityType.asset) {\n//            return assetService.saveAsset(entity);\n//        } else if (vm.entityType == types.entityType.device) {\n//            return deviceService.saveDevice(entity);\n//        }\n//    }\n//    \n//    function saveAttributes(entityId) {\n//        var attributesArray = [];\n//        for (var key in vm.attributes) {\n//            attributesArray.push({key: key, value: vm.attributes[key]});\n//        }\n//        if (attributesArray.length > 0) {\n//            attributeService.saveEntityAttributes(entityId.entityType, entityId.id, \"SERVER_SCOPE\", attributesArray);\n//        } \n//    }\n//    \n//    function saveRelations(entityId) {\n//        var tasks = [];\n//        for (var i=0; i < vm.relations.length; i++) {\n//            var relation = {\n//                type: vm.relations[i].relationType\n//            };\n//            if (vm.relations[i].direction == types.entitySearchDirection.from) {\n//                relation.to = vm.relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = vm.relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        $q.all(tasks).then(function(){\n//            updateAliasData();\n//        });\n//    }\n//    \n//    function updateAliasData() {\n//        var aliasIds = [];\n//        for (var id in widgetContext.aliasController.resolvedAliases) {\n//            aliasIds.push(id);\n//        }\n//        var tasks = [];\n//        aliasIds.forEach(function(aliasId) {\n//            widgetContext.aliasController.setAliasUnresolved(aliasId);\n//            tasks.push(widgetContext.aliasController.getAliasInfo(aliasId));\n//        });\n//        $q.all(tasks).then(function() {\n//            $rootScope.$broadcast('widgetForceReInit');\n//        });\n//    }\n//}"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": null,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "displayTimewindow": true
        },
        "id": "fba8b82f-4b63-d360-68e1-9481f57706b1"
      },
      "f1a629d9-faa9-ae03-8c9e-91e0037b17bc": {
        "isSystemType": true,
        "bundleAlias": "iotopentech",
        "typeAlias": "perfil2",
        "type": "static",
        "title": "New widget",
        "sizeX": 7,
        "sizeY": 11,
        "config": {
          "datasources": [],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "showResultMessage": true,
            "widgetTitle": "PERFUL DE"
          },
          "title": "PERFIL DE USUARIO",
          "dropShadow": true,
          "showTitleIcon": false,
          "titleIcon": null,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showLegend": false,
          "actions": {}
        },
        "id": "f1a629d9-faa9-ae03-8c9e-91e0037b17bc"
      }
    },
    "states": {
      "default": {
        "name": "Configuración",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "fba8b82f-4b63-d360-68e1-9481f57706b1": {
                "sizeX": 9,
                "sizeY": 11,
                "row": 0,
                "col": 7
              },
              "f1a629d9-faa9-ae03-8c9e-91e0037b17bc": {
                "sizeX": 7,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "color": "rgba(0,0,0,0.870588)",
              "columns": 24,
              "margins": [
                10,
                10
              ],
              "backgroundSizeMode": "100%"
            }
          }
        }
      }
    },
    "entityAliases": {
      "bc41b835-4a1d-49fc-de3b-142ec2484fd4": {
        "id": "bc41b835-4a1d-49fc-de3b-142ec2484fd4",
        "alias": "ActivoROOT",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetType": "ROOT",
          "assetNameFilter": ""
        }
      }
    },
    "timewindow": {
      "displayValue": "",
      "selectedTab": 0,
      "hideInterval": false,
      "hideAggregation": false,
      "hideAggInterval": false,
      "realtime": {
        "interval": 1000,
        "timewindowMs": 60000
      },
      "history": {
        "historyType": 0,
        "interval": 1000,
        "timewindowMs": 60000,
        "fixedTimewindow": {
          "startTimeMs": 1584265253803,
          "endTimeMs": 1584351653803
        }
      },
      "aggregation": {
        "type": "AVG",
        "limit": 25000
      }
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": true,
      "showDashboardTimewindow": true,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true
    }
  },
  "name": "Configuración"
}